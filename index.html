<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Math Quiz</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" rel="stylesheet">

  </head>
  <body>
    <script src="https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>
    <div class="container" id="setting">
        <div class="row text-center">
            <div class="col-md-3"></div>
            <div class="col-md-6">
                <form class="form-horizontal">
                    <hr/>
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-3 control-label">题目数量</label>
                        <label class="radio-inline">
                            <input type="radio" name="quiz-count" value="10"> 10
                        </label>
                        <label class="radio-inline">
                            <input type="radio" name="quiz-count" value="20"> 20
                        </label>
                        <label class="radio-inline">
                            <input type="radio" name="quiz-count" value="30" checked> 30
                        </label>
                    </div>
                    <hr/>
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-3 control-label">题目类型</label>
                        <label class="radio-inline">
                            <input type="radio" name="quiz-type" value="add"> 加法
                        </label>
                        <label class="radio-inline">
                            <input type="radio" name="quiz-type" value="minus"> 减法
                        </label>
                        <label class="radio-inline">
                            <input type="radio" name="quiz-type" value="mix" checked> 加减法
                        </label>
                    </div>
                    <hr/>
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-3 control-label">题目范围</label>
                        <label class="radio-inline">
                            <input type="radio" name="quiz-max" value="10" checked> 10以内
                        </label>
                        <label class="radio-inline">
                            <input type="radio" name="quiz-max" value="20"> 20以内
                        </label>
                        <label class="radio-inline">
                            <input type="radio" name="quiz-max" value="100"> 100以内
                        </label>
                    </div>
                    <hr/>
                    <div class="form-group">
                        <label for="inputEmail3" class="col-sm-3 control-label">计时类型</label>
                        <label class="radio-inline">
                            <input type="radio" name="quiz-time" value="180" checked> 倒计时3分钟
                        </label>
                        <label class="radio-inline">
                            <input type="radio" name="quiz-time" value="60"> 倒计时1分钟
                        </label>
                        <label class="radio-inline">
                            <input type="radio" name="quiz-time" value="0"> 普通计时
                        </label>
                    </div>
                    <hr/>
                    <div class="form-group">
                        <button type="submit" class="btn btn-default submit">生成试卷，开始答题</button>
                    </div>
                    <hr/>
                </form>
            </div>
            <div class="col-md-3"></div>
        </div>
    </>
    <div class="container" id="quiz">
        <div class="row text-center" id="question">
            <div class="col-md-3"></div>
            <div class="col-md-6">
                <span class="num" id="fn">3</span>
                <span class="op" id="op">+</span>
                <span class="num" id="sn">4</span>
                <span class="op">=</span>
                <span class="num" id="ret" value="7">?</span>
            </div>
            <div class="col-md-3"></div>
        </div>
        <div class="row"><hr/></div>
        <div class="row text-center" id="keypad">
            <div class="col-md-3"></div>
            <div class="col-md-6">
                <div class="row">
                    <div class="col-md-4 btn btn-default ky" id="k1">
                        <div class="num">1</div>
                    </div>
                    <div class="col-md-4 btn btn-default ky" id="k2">
                        <div class="num">2</div>
                    </div>
                    <div class="col-md-4 btn btn-default ky" id="k3">
                        <div class="num">3</div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 btn btn-default ky" id="k4">
                        <div class="num">4</div>
                    </div>
                    <div class="col-md-4 btn btn-default ky" id="k5">
                        <div class="num">5</div>
                    </div>
                    <div class="col-md-4 btn btn-default ky" id="k6">
                        <div class="num">6</div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 btn btn-default ky" id="k7">
                        <div class="num">7</div>
                    </div>
                    <div class="col-md-4 btn btn-default ky" id="k8">
                        <div class="num">8</div>
                    </div>
                    <div class="col-md-4 btn btn-default ky" id="k9">
                        <div class="num">9</div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 btn btn-default ky" id="k0">
                        <div class="num">0</div>
                    </div>
                    <div class="col-md-6 btn btn-default ky" id="k10">
                        <div class="num">X</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3"></div>
        </div>
        <div class="row"><hr/></div>
        <div class="row text-center">
            <div class="col-md-3"></div>
            <div class="col-md-6">
            <span class="nav btn btn-link" id="prev">&lt;&nbsp;&lt;</span>
            <span class="nav btn btn-primary" id="answer">确定</span>
            <span class="nav btn btn-link" id="next">&gt;&nbsp;&gt;</span>
            <div class="col-md-3"></div>
        </div>
    </div>
    <script>
        const shuffle = ([...arr]) => {
            let m = arr.length;
            while (m) {
                const i = Math.floor(Math.random() * m--);
                [arr[m], arr[i]] = [arr[i], arr[m]];
            }
            return arr;
        };

        function decompose_num(n) {
            var ret_add = [];
            var ret_minus = [];
            for (i = 0; i < n; i++) {
                ret_add.push([0, i, n-i, n]);
                ret_minus.push([1, n, n-i, i]);
            }
            return [ret_add, ret_minus];
        };

        function make_quiz(sum, count, type) {
            var ret = [];
            var ret_add = [];
            var ret_minus = [];
            for (i = 3; i <= sum; i++) {
                var r = decompose_num(i);
                ret_add = ret_add.concat(r[0]);
                ret_minus = ret_minus.concat(r[1]);
            }
            if (type == "add") {
                ret = shuffle(ret_add).slice(0, count);
            } else if (type == "minus") {
                ret = shuffle(ret_minus).slice(0, count);
            } else if (type == "mix") {
                ret = shuffle(ret_add.concat(ret_minus)).slice(0, count);
            }
            return shuffle(ret);
        };

        //console.log(make_quiz(10, 30, "add"));
        //console.log(make_quiz(10, 30, "minus"));
        //console.log(make_quiz(10, 30, "mix"));

        function set_question(quiz, index) {
            console.log(quiz);
            var q = quiz[index];
            var op = "";
            switch (q[0]) {
                case 0:
                    op = "+";
                    break;
                case 1:
                    op = "-";
                    break;
                case 2:
                    op = "×";
                    break;
                case 3:
                    op = "÷";
                    break;
            }
            $("#op").html(op);
            $("#fn").html(q[1]);
            $("#sn").html(q[2]);
            $("#ret").attr("value", q[3]);
        };

        $(".ky").bind("click", function() {
            var k = this.id.replace("k","");
            var answer =  $("#ret").html();
            if (answer == '?') answer = 0;
            if (k < 10 && parseInt(answer) < 99) {
                $("#ret").html(parseInt(answer + k));
            } else if (k == 10) {
                var new_value = answer.slice(0, -1);
                if (new_value == '') new_value='?';
                $("#ret").html(new_value);
            }
        });

        $("#answer").bind("click", function() {
            var answer =  $("#ret").html();
            if ($("#ret").attr("value") == answer) {
                alert("你答对了！");
            } else {
                alert("Oops, 你答错了！");
            }
        });

        $(function(){
            n = 10;
            quiz_type = "add";
            count = 5;
            quiz = make_quiz(n, count, quiz_type);
            index = 0;
            set_question(quiz, index);
            $("#next").bind("click", function() {
                if (index < count-1) {
                    index++;
                    set_question(quiz, index);
                } else {
                    index = count-1;
                }
            });

            $("#prev").bind("click", function() {
                if (index > 0) {
                    index--;
                    set_question(quiz, index);
                } else {
                    index = 0;
                }
            });

        });

    </script>
    <style>
        .num {
            font-size: 80px;
            text-align: center;
        }
        .op {
            font-size: 80px;
            text-align: center;
            padding: 10px;
        }
        .ky .num {
            font-size: 48px;
        }
        .fl {
            float: left;
        }
        .rl {
            float: right;
        }
        .btn .num {
            padding-left: 20px;
            padding-right: 20px;
            margin-top: 2px;
        }
        .nav {
            font-size: 42px;
            padding-left: 40px;
            padding-right: 40px;
        }
        
        .submit {
            font-size: 24px;
        }
        .form-horizontal {
            font-size: 20px;
        }
    </style>
  </body>
</html>
